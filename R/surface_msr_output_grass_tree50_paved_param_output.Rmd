---
title: "patch family surface transfer balances: turfgrass and tree 2 stratum"
date: "2023-09-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(patchwork)
library(lubridate)
library(RHESSysIOinR)
source("/Volumes/GoogleDrive/My Drive/help_with_rhessys/watbal.R")
library(here)
dir = "out/tgrass50/msr_on"
```


```{r basin, echo=FALSE}

wb_bas = readr::read_delim(here(dir,"param_u_bas.csv")) 

watbal = wb_bas %>% 
  dplyr::filter(year==2019) %>% 
  group_by(date, veg_area) %>% 
  summarize(balance = mean(watbal)) 

ggplot(watbal) + geom_point(aes(x=date, y=balance)) + ggtitle("basin water balance") + facet_grid("veg_area")

```

turfgrass parameters that were set up using just single patch of turfgrass and irrigation

- did not balance with sharing on and oak tree
- sharing with pavement does balance  - more water input from surface transfer, no rz transfer  


#### paved patch fam: 50% turfgrass, 50% pavement 

patchIDs:

- 60853701 = two stratum: turfgrass and tree 
- 60853702 = pavement

```{r patch, echo=FALSE}
wb_p = readr::read_delim(here(dir,"param_u_p.csv")) 
wb_p2 = readr::read_delim(here(dir, "../param_u_p.csv"))

patchout = rbind(wb_p, wb_p2) %>% group_by(year, msr, veg_area, patchID) %>% summarise_all(mean)

# plot boxplots 
ggplot(patchout) + geom_boxplot(aes(x=as.factor(patchID), y=surface_transfer, col=as.factor(veg_area))) + facet_grid('msr')

ggplot(patchout) + geom_boxplot(aes(x=as.factor(patchID), y=rz_storage, col=as.factor(veg_area))) + facet_grid('msr')

ggplot(patchout) + geom_boxplot(aes(x=as.factor(patchID), y=unsat_storage, col=as.factor(veg_area))) + facet_grid('msr')

ggplot(patchout) + geom_boxplot(aes(x=as.factor(patchID), y=streamflow, col=as.factor(veg_area))) + facet_grid('msr')

ggplot(patchout) + geom_boxplot(aes(x=as.factor(patchID), y=evap, col=as.factor(veg_area))) + facet_grid('msr')

ggplot(patchout) + geom_boxplot(aes(x=as.factor(patchID), y=rootzone.S, col=as.factor(veg_area))) + facet_grid('msr')

ggplot(patchout) + geom_boxplot(aes(x=as.factor(patchID), y=rootzone.field_capacity, col=as.factor(veg_area))) + facet_grid('msr')


```

#### stratum output 

```{r msr, echo=FALSE}

strat = readr::read_delim(here(dir, "param_u_strat.csv"))
strat2 = readr::read_delim(here(dir, "../param_u_strat.csv"))

stratout = rbind(strat2) %>% 
  group_by(year, msr, veg_area, veg_parm_ID) %>% 
  summarise_all(mean) %>% 
  mutate(id = factor(veg_parm_ID, 
                     levels = c(11, 3, 1), 
                     labels=c("tree", "turfgrass","no veg")))
  
ggplot(stratout) + geom_boxplot(aes(x=msr, y=epv.proj_lai, col=id)) + facet_grid("veg_area")

ggplot(stratout) + geom_boxplot(aes(x=msr, y=epv.height, col=id)) + facet_grid("veg_area")

ggplot(stratout) + geom_boxplot(aes(x=msr, y=rootzone.depth, col=id)) + facet_grid("veg_area")


ggplot(stratout) + geom_boxplot(aes(x=msr, y=cs.totalc, col=id)) + facet_grid("veg_area")

ggplot(stratout) + geom_boxplot(aes(x=msr, y=trans, col=id)) + facet_grid("veg_area")

ggplot(stratout) + geom_boxplot(aes(x=msr, y=cdf.psn_to_cpool, col=id)) + facet_grid("veg_area")

ggplot(stratout) + geom_boxplot(aes(x=msr, y=npp, col=id)) + facet_grid("veg_area")
```



